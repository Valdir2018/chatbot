<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Chatbot</title>
    <link rel="stylesheet" type="text/css" href="./public/css/style.css">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<script type="text/javascript" src="./public/js/transition.min.js"></script>

</head>
<body>

	<header>
		<nav class="flex-menu">
			<ul>
				<li><a href="create.html">
					<span class="material-icons">add</span>Cadastrar</a>
				</li>
				<li><a href="edit.html">
					<span class="material-icons">edit</span>Editar</a>
				</li>
			</ul>
		</nav>
	</header>

	

    <div class="box flex-animate-bottom" data-id="0">
		<div>
			<div class="box-header"><span class="material-icons" id="btn-close">close</span></div>
			 <div class="flex-item-search">
				 <input type="text" name="keyword" id="keyword" placeholder="Digite aqui o que deseja" >
				 <button type="button" class="search">Buscar</button>
			 </div>
		</div>
		<div class="popup-content">
			<span id="innerHTML">Olá, eu sou o Will, posso te ajudar ? <br/> Informe o termo que deseja encontrar, ex: <br/><br/>
			1. Inteligência Artificial <br/> 2. Engenharia de Software <br/> 3. Criptografia</span>
		</div>
	</div>
	<div class="item-active">
		<a id="icone">
			<img src="./public/images/580b57fbd9996e24bc43be11.png" id="imagem" onmouseenter="toggleImageMouseEnter(this)"  
			onmouseout="toggleImageMouseOut(this)">
		</a>
	</div>

    <script type="text/javascript">

      const button = document.querySelector('.search');
      const icon  = document.getElementById('icone');
      const close = document.getElementById('btn-close');
      var box   = document.getElementsByClassName('box')[0];

	  var span = document.getElementById('innerHTML');
	  var imagem  = document.getElementById('imagem');
      
	  button.addEventListener('click', handleChangedKeyword);
      icone.addEventListener('click', animate);
      close.addEventListener('click', hideElement);

      window.addEventListener('keyup', function() {
		 var keyword = document.getElementById('keyword');
	  });

      function hideElement(event) {
        animate(event);

		span.innerHTML = ''; 
		span.innerHTML = valor.text;
      }
      
      function animate(element) {
	    if (box._side == "top") {
	        box._side = "bottom";
	        box.classList.add('box-active');
	        transition.begin(box, "transform translateY(700px) translateY(0) 1s", {
	            beginFromCurrentValue: true
	        });

	    } else {
	       box._side = "top";
	       transition.begin(box, "transform translateX(0) translateY(600px) 0.8s", {
	            beginFromCurrentValue: true
	       });
	    }
	  }


	  async function handleChangedKeyword() {
		  let context = keyword.value;
		  context = context.toLowerCase();

		  const response = await fetch('data/keyword.json');
		  const result = await response.json();
		  
		  if (!response.ok) {
			  throw new Error("HTTP error, status = " + response.status);
		  }

		  const data =  result.filter(item => item.keyword === context);

		  if (data.length == 0 || data === null) {
			  span.innerHTML = ''; 
			  span.innerHTML = messageFromInnerHtml(keyword);
			  return;
		  }

		  data.forEach(function(valor) {
			   span.innerHTML = ''; 
			   span.innerHTML = valor.text;
		  });
	  }

	  function messageFromInnerHtml(term) {
		  let message = 
		  `Ops ! nenhuma ocorrência foi encontrada para esse termo <span id="word">${term.value}</span>`;
		  return message;
	  }

	  function toggleImageMouseEnter(image) {
		  image.src = "./public/images/580b57fbd9996e24bc43be11.png";
	  }

	  function toggleImageMouseOut(image) {
		  image.src = "./public/images/580b57fbd9996e24bc43be10.png";
	  }

    </script>

    
</body>
</html>